model Account {
  id String @id @default(uuid())

  // 對應 userId: { type: Schema.Types.ObjectId, ref: "User", required: true }
  userId String
  // 定義外鍵關聯：當 User 被刪除時，Account 也一併刪除 (Cascade) 一個account 只能有一個user
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // 對應 password: { type: String }
  password String?

  // 對應 provider: { type: String, required: true }
  provider String

  // 對應 providerAccountId: { type: String, required: true }
  providerAccountId String

  // 對應 timestamps: true
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // 建立複合索引 (可選，但推薦)：避免同一個 provider 重複綁定同一個 ID
  @@unique([provider, providerAccountId])
}

// prisma/schema/main.prisma

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// 共用的 Enum 建議放在這裡，或者跟隨主要使用的 Model
enum ProcessStatus {
  uploading
  processing
  completed
  error
}

// prisma/schema/model.prisma

model Model {
  id      String @id @default(uuid())
  shortId String @unique // 用於分享的短 ID
  name    String // 原始檔名
  fileId  String @unique // MinIO / Tus ID (關鍵關聯)

  // 建立與 User 的關聯
  uploaderId String // 外鍵欄位
  uploader   User   @relation(fields: [uploaderId], references: [id])
  size       String @default("") // 檔案大小 (bytes)

  status       ProcessStatus @default(uploading)
  errorMessage String?

  // 關聯：Prisma 會自動跨檔案識別 Post 模型
  posts Post[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// prisma/schema/post.prisma

model Post {
  id          String  @id @default(uuid())
  shortId     String  @unique
  title       String
  category    String
  description String?
  type        String

  // PostgreSQL 的原生陣列功能
  keywords   String[]
  coverImage String
  images     String[]

  // 關聯到 Model (3D 檔案)
  modelId String
  model   Model  @relation(fields: [modelId], references: [id])

  uploaderId String
  uploader   User   @relation(fields: [uploaderId], references: [id])

  // 相關文章 ID (簡易關聯)
  relatedPosts String[]

  permission String
  team       String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Role {
  Free
  Pro
}

model User {
  // 使用 String 型別以兼容舊的 MongoDB ObjectId，新資料預設使用 cuid
  id String @id @default(uuid())

  // 對應 userName: { type: String, required: true, unique: true }
  userName String @unique

  // 對應 email: { type: String, required: true, unique: true }
  email String @unique

  // 對應 role: { type: String, enum: ["Free", "Pro"], required: true }
  role Role @default(Free)

  // 對應 image: { type: String }
  image String?

  // 對應 team: { type: [Schema.Types.ObjectId] }
  // Postgres 支援字串陣列，這裡先用來存 ID。
  // 若未來有 Team table，建議改成關聯 @relation
  team String[]

  // 對應 userCollection: { type: [Schema.Types.ObjectId] }
  userCollection String[]

  // 建立與 Account 的關聯 (User 能有多個 Account) provider不同會有不同account
  accounts Account[]

  // 一個使用者可以擁有多個模型
  models Model[]

  posts     Post[]
  // 對應 timestamps: true
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
